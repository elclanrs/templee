(function(win){function Templee(data){this.data=data;this.length=this.data.length}function templee(data){return new Templee(data)}function _curry(fn,that){return function(){return fn.apply(that||arguments[0],[].slice.call(arguments))}}function _extend(obj,target){for(var o in obj)target[o]=obj[o];return target}function _template(arr,html){html=html.join("");var single=/#\{(\w+)\}/g,list=/@\{([^{}]+)=\{(.+)\}([^{}]+)\}/g;return arr.map(function(obj){return html.replace(single,function(_,match){return obj[match]}).replace(list,function(_,open,match,close){return obj[match].map(function(val){return open+val+close}).join("")})}).join("")}Templee.prototype={_new:function(result){result=result.map(function(o){return _extend(o,{})});this.length=this.data.length;return templee(result)},_filter:function(fn){return this._new(this.data.filter(function(user,i){return fn.call(this,user[this.prop],i)}.bind(this)))},get:function(prop){if(prop)return this.map(function(){return this[prop]});return this.data},where:function(prop){return this.prop=prop,this},and:function(prop){return this.where(prop)},is:function(condition){var regex=condition instanceof RegExp?condition:new RegExp("^"+condition+"$");var symbol=/^([<>=%]+)([\d.]+)/.exec(condition)||[0,null,0];if(symbol[1])return this[symbol[1]](+symbol[2]);return this._filter(function(prop){return regex.test(prop)})},">":function(v){return this._filter(function(p){return p>v})},">=":function(v){return this._filter(function(p){return p>=v})},"<":function(v){return this._filter(function(p){return p<v})},"<=":function(v){return this._filter(function(p){return p<=v})},"%":function(v){return this._filter(function(p){return p%v===0})},add:function(data){return this._new(this.data.concat[data])},slice:function(start,end){return this._new(this.get().slice(start,end))},each:function(fn){return this.get().some(_curry(fn)),this},map:function(fn){return this._new(this.data.map(_curry(fn)))},sort:function(fn){return this._new(this.data.sort(function(a,b){return fn?fn.apply(this,a,b):a>b}.bind(this)))},eq:function(index){return this._new(this.data[index])},html:function(template){return _template(this.data,template)}};win.templee=templee})(window);